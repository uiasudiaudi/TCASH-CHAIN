if (XBUILD_TEST)
    add_definitions(-DXENABLE_TESTS)
endif()

if (DISABLE_REAL_STAKE)
    add_definitions(-DXENABLE_MOCK_ZEC_STAKE)
endif()
if (MAINNET_ACTIVATED)
    add_definitions(-DMAINNET_ACTIVATED)
endif()

if (STATIC_CONSENSUS)
    add_definitions(-DSTATIC_CONSENSUS)
endif()
if (ELECT_WHEREAFTER)
    add_definitions(-DELECT_WHEREAFTER)
endif()
if (CONSENSUS_SWAP)
    add_definitions(-DCONSENSUS_SWAP)
endif()

aux_source_directory(./ xvm)
aux_source_directory(./manager manager)
aux_source_directory(./xcontract xcontract)
aux_source_directory(./xserialization xserialization)
aux_source_directory(./xerror xerror)
aux_source_directory(./xsystem_contracts/deploy system_contracts_deploy)
aux_source_directory(./xsystem_contracts/src system_contracts_src)
aux_source_directory(./xsystem_contracts/xeth system_contracts_xeth)

if (XBUILD_CONSORTIUM)
    aux_source_directory(./xsystem_contracts/consortium system_contracts_consortium)
    add_library(xvm STATIC ${xvm} ${manager} ${xcontract} ${xserialization} ${xerror} ${system_contracts_deploy} ${system_contracts_src} ${system_contracts_xeth} ${system_contracts_consortium})
else()
    add_library(xvm STATIC ${xvm} ${manager} ${xcontract} ${xserialization} ${xerror} ${system_contracts_deploy} ${system_contracts_src} ${system_contracts_xeth})
endif()

add_dependencies(xvm xstatestore xconfig xstore xchain_upgrade xcertauth xdata xdata xevm_common xcommon xrouter xcodec xbasic xxbase)

if (${XOS_ID} MATCHES "ubuntu")
    find_library(jsoncpp_LIBRARIES libjsoncpp.a HINTS ${LIBRARY_OUTPUT_DIRECTORY} REQUIRED)
    target_link_libraries(xvm PRIVATE xstatestore xconfig xevm_common xrouter xcertauth xdata xchain_upgrade xdata xcommon xcodec xbasic xstore xxbase ${protobuf_LIBRARY} ${z_LIBRARY} ${jsoncpp_LIBRARIES} ethash keccak)
else()
    target_link_libraries(xvm PRIVATE xstatestore xconfig xevm_common xrouter xcertauth xdata xchain_upgrade xdata xcommon xcodec xbasic xstore xxbase protobuf jsoncpp ethash keccak)
endif()

if (BUILD_METRICS)
    #add_dependencies(xvm xmetrics)
    target_link_libraries(xvm PRIVATE xmetrics)
endif()

if (XBUILD_CONSORTIUM)
    target_link_libraries(xvm PRIVATE xca_auth)
endif()
